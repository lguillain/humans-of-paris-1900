<!DOCTYPE html>
<!-- saved from url=(0047)https://cs.stanford.edu/people/karpathy/tsnejs/ -->
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>tSNEJS demo</title>

    <script type="text/javascript" async="" src="ga.js"></script>
    <!--<script src="jquery-1.8.3.min.js"></script>-->
    <script src="https://code.jquery.com/jquery-1.8.3.min.js"><</script>
    <script src="d3.min.js"></script>
    <script src="tsne.js"></script>
    <link href="tnse.css" rel="stylesheet" type="text/css">

    <!-- JS syntax highlighting -->
    <script type="text/javascript" src="/static/shCore.js"></script>
    <script type="text/javascript" src="/static/shBrushJScript.js"></script>
    <link type="text/css" rel="stylesheet" href="/static/shCoreDefault.css">
    <script type="text/javascript">SyntaxHighlighter.all();</script>
    <style>
        .syntaxhighlighter {
            width: 100% !important;
            margin: 1em 0 1em 0 !important;
            position: relative !important;
            overflow: hidden !important;
            font-size: 14px !important;
        }
    </style>

    <script>

        var opt = {epsilon: 10, perplexity: 15};
        var T = new tsnejs.tSNE(opt); // create a tSNE instance

        var Y;

        var data;

        function updateEmbedding() {
            var Y = T.getSolution();
            svg.selectAll('.u')
                .data(data.users)
                .attr("transform", function (d, i) {
                    return "translate(" +
                        ((Y[i][0] * 20 * ss + tx) + 400) + "," +
                        ((Y[i][1] * 20 * ss + ty) + 300) + ")";
                });
        }

        var svg;

        function drawEmbedding() {
            $("#embed").empty();
            var div = d3.select("#embed");

            // get min and max in each column of Y
            var Y = T.Y;

            svg = div.append("svg") // svg is global
                .attr("width", 800)
                .attr("height", 600);

            var g = svg.selectAll(".b")
                .data(data.users)
                .enter().append("g")
                .attr("class", "u");

            g.append("svg:image")
                .attr('x', 0)
                .attr('y', 2)
                .attr('width', 24)
                .attr('height', 24)
                .attr("xlink:href", function (d) {
                    return "images/" + d;
                })

            g.append("text")
                .attr("text-anchor", "top")
                .attr("font-size", 12)
                .attr("fill", "#333")
                .text(function (d) {
                    return d;
                });

            var zoomListener = d3.behavior.zoom()
                .scaleExtent([0.1, 10])
                .center([0, 0])
                .on("zoom", zoomHandler);
            zoomListener(svg);
        }

        var tx = 0, ty = 0;
        var ss = 1;

        function zoomHandler() {
            tx = d3.event.translate[0];
            ty = d3.event.translate[1];
            ss = d3.event.scale;
        }

        function step() {
            for (var k = 0; k < 1; k++) {
                T.step(); // do a few steps
            }
            updateEmbedding();
        }

        $(window).load(function () {

            $.getJSON("pretty_faces.json", function (j) {
                data = j;
                T.initDataDist(data.mat); // init embedding
                drawEmbedding(); // draw initial embedding

                //T.debugGrad();
                setInterval(step, 0);
                //step();

            });
        });

    </script>

</head>

<body>

<div id="embed">
    <svg width="800" height="600"></svg>
</div>


</body>
</html>
